<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>go doc の使い方・コメントを書いて、ちゃんと読む | ayasuda.github.io</title>
<meta name=keywords content="Go,Tools,Command,godoc"><meta name=description content="godoc コマンドを使ってドキュメントを読む方法についてまとめてみました"><meta name=author content="ayasuda"><link rel=canonical href=https://ayasuda.github.io/pages/introduction_go_doc/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ayasuda.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ayasuda.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ayasuda.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ayasuda.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ayasuda.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ayasuda.github.io/pages/introduction_go_doc/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="go doc の使い方・コメントを書いて、ちゃんと読む"><meta property="og:description" content="godoc コマンドを使ってドキュメントを読む方法についてまとめてみました"><meta property="og:type" content="article"><meta property="og:url" content="https://ayasuda.github.io/pages/introduction_go_doc/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2019-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2019-04-12T00:00:00+00:00"><meta property="og:site_name" content="ayasuda.gihtub.io"><meta name=twitter:card content="summary"><meta name=twitter:title content="go doc の使い方・コメントを書いて、ちゃんと読む"><meta name=twitter:description content="godoc コマンドを使ってドキュメントを読む方法についてまとめてみました"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pages","item":"https://ayasuda.github.io/pages/"},{"@type":"ListItem","position":2,"name":"go doc の使い方・コメントを書いて、ちゃんと読む","item":"https://ayasuda.github.io/pages/introduction_go_doc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"go doc の使い方・コメントを書いて、ちゃんと読む","name":"go doc の使い方・コメントを書いて、ちゃんと読む","description":"godoc コマンドを使ってドキュメントを読む方法についてまとめてみました","keywords":["Go","Tools","Command","godoc"],"articleBody":"Go 言語ではソースコード中にコメントを書くことで自動的に API ドキュメントを生成する方法が最初からサポートされています。\nGodoc: documenting Go code でも、\nThe Go project takes documentation seriously.\nと書かれているほど、しっかりと練られた文書化ツールが揃っています。\nとはいえ、良い書き方や読み方がわからないと、書く気が起きませんよね？ そんなわけで、本文書では文書生成用のドキュメントの書き方と、それぞれのドキュメントの読み方について記していきます。\ngodoc の動きの確認 まず、サンプルコードを用意しましょう。\n$ mkdir -p $GOPATH/src/path/to/your/library $ cd $GOPATH/src/path/to/youre/library $ vim sample.go package sample import \"fmt\" func Foo(s string) string { return \"Foo \" + s + \" ooF\" } func PrintFoo(s string) { fmt.Println(Foo(s)) } この段階で、すでに godoc コマンドからドキュメントを参照可能です\nまずはブラウザから見てみましょう。-http オプションで、ドキュメントをみるための web サーバが起動できます。\n$ godoc -http=:8080 コマンドを実行したら http://localhost:8080 にアクセスしてみましょう。まるで公式サイトのような Web ページが見られると思います。\nヘッダの「Packages」リンクから、標準ライブラリおよび、GOPATH に持ってきている全てのパッケージのドキュメント が確認できます。 もちろん、たった今作った sample.Foo のドキュメントもあります！\nなお、この時の URL は http://localhost:600/pkg/path/to/your/library/ になります。わかりやすいですね！\n簡単なコメントを書く Godoc で読むためのコメントはとてもシンプルで、godoc がなくても読みたくなるようなコメントが書けるように意識して書くのが良いでしょう。Go Blog でも以下のように言及されています。\nGodoc comments are just good comments, the sort you would want to read even if godoc didn’t exist.\nコメントは type, variable, constant, function, package に書くことができます。また、コメントには一つルールがあり、その要素名で始める必要があります。\n// sample パッケージはコメントの書き方と読み方の例を提供します。 package sample import \"fmt\" // Bar はとある変数です var Bar = \"some variable\" // Baz はとある定数です const Baz = \"some constant\" // Qux はとある構造体です type Qux struct { // A には適当な文字列をどうぞ A string // A にも適当な文字列をどうぞ B string } // Foo はとりあえず前後に変な文字をくっけます func Foo(s string) string { return \"Foo \" + s + \" ooF\" } // PrintFoo はとりあえず前後に変な文字をくっけます func PrintFoo(s string) { fmt.Println(Foo(s)) } こいつをブラウザで表示すると下記のようにいい感じに表示されます。\nブラウザ以外からドキュメントを読む godoc のヘルプを見ればすぐにわかりますが、godoc package [name] でそのパッケージおよび各種項目のドキュメントがコマンドラインから読めます。\n$ godoc fmt Println func Println(a ...interface{}) (n int, err error) Println formats using the default formats for its operands and writes to standard output. Spaces are always added between operands and a newline is appended. It returns the number of bytes written and any write error encountered. 自作のライブラリ含めたサードパーティのライブラリのドキュメントを読む場合は、パッケージをフルパスで書きましょう。先に作ったサンプルの場合なら次のようになります。\ngodoc path/to/your/library PrintFoo func PrintFoo(s string) PrintFoo はとりあえず前後に変な文字をくっけます Q: パッケージ名の sample はどこに行ったのでしょうか？\nAnswer: 僕がライブラリの作り方ミスって、sample が消失しただけだよ！ golang のライブラリの作り方はこの文書の範疇じゃないから仕方ないね！ (具体的には、パッケージ名とディレクトリ名は通常一致させるべき)\nもっと詳しくドキュメントを書く ここまでで日常使いには十分ですが、さらに詳しく、いろいろ書きたい人向けの機能にもふれておきましょう。\nパッケージドキュメントを盛り盛りにする 専門知識が必要なパッケージを作りたいときなどに、プログラム本体のコメントとしてドキュメントを書くとちょっと長くなるケースがあると思います。 そういう時はパッケージドキュメント専用のファイルを作ることができます。\n具体的には、 doc.go というファイルを用意し、そこにパッケージのドキュメントを記述します。\ngob パッケージ では、この機能が使われており、ドキュメントは src/encoding/gob/doc.go に書かれています。\n-notes オプションで追加項目をリストアップする 基本的にコード中や指定箇所以外のコメントは無視されますが、godoc のノート機能を使うと、より多くのメタ情報を知るせます。\nデフォルトでは BUG(who) が定義されているので、例えば、下記のようなコメントを書くと、godoc で見たときにひとまとまりに表示されます。\n// Foo はとりあえず前後に変な文字をくっけます // // BUG(ayasuda) ごめん、なんかバグある気がする func Foo(s string) string { return \"Foo \" + s + \" ooF\" } ブラウザで見ると下記のようになります。\n繰り返しになりますが、デフォルトでは BUG が定義されているので、コメント中で BUG(who) を記述可能です。-notes オプションでこの定義は自由に増やせます。\n簡単なフォーマット コメントを書く際に、以下のルールに従うとことで HTML 化した際のフォーマットを変更することができます。\n連続した行は一つの段落と見なされます 段落を区切りたい場合は空白行を間に入れる必要があります 英大文字で始まり、直前が句読点ではない単一行の段落は見出しになります 字下げすると整形済みテキストになります URL はリンクになります そんなわけで、例えば、下記のようなコメントを書くと\n/* ここはパッケージコメントの最初になるから見出しではないよー Hで始まり単一行かつ句読点なしかつ前が見出しではないのでこれは見出し 段落段落 段落段落 段落段落 次の段落 次の段落 整形済みテキスt 次のやつはリンクになるはず。 https://golang.org/ */ package sample 以下のようにHTML化されます。\nこれ以上にいろいろ装飾したい場合は、 最悪、ソースが ここ にあるので・・・\nExample をつけるには 公式ドキュメントのいくつかの関数では、 Example が付いてます。 これは Testable Examples を利用して作られています。\n上記の sample パッケージに対して Testable Example を作るなら、まずは /path/to/your/library/example_test.go を用意します。 パッケージ名は sample_test としてください。\n中には次のルールでサンプルがかけます。\nfunc ExampleFoo() // Foo 関数のサンプルコードになります func ExampleBar_Qux() // Bar 構造体の Qux 関数のサンプルコードになります func Example() // パッケージ全体のサンプルコードになります func ExampleFoo_foo // Foo 関数のサンプルコード(fooの場合) また、テストコード中に Output: から始まるコメントを記載することで、標準出力に書き込まれた値をチェックすることができます。\nそんなわけで、こんなコードを書きます。\npackage sample_test import ( \"fmt\" \"path/to/your/library\" ) func ExampleFoo() { fmt.Println(sample.Foo(\"foo\")) // Output: Foo foo ooF } テストはいつも通り、go test コマンドから実行可能です。\n$ go test PASS ok path/to/your/library 0.004s 後は、ドキュメントを生成すると、Example が記載されているはずです。\n参照 Godoc: documenting Go code - The Go Blog godoc - GoDoc Testable Examples in Go - The Go Blog ","wordCount":"2533","inLanguage":"en","datePublished":"2019-04-12T00:00:00Z","dateModified":"2019-04-12T00:00:00Z","author":{"@type":"Person","name":"ayasuda"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ayasuda.github.io/pages/introduction_go_doc/"},"publisher":{"@type":"Organization","name":"ayasuda.github.io","logo":{"@type":"ImageObject","url":"https://ayasuda.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ayasuda.github.io/ accesskey=h title="ayasuda.github.io (Alt + H)">ayasuda.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://ayasuda.github.io/pages/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ayasuda.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ayasuda.github.io/pages/>Pages</a></div><h1 class=post-title>go doc の使い方・コメントを書いて、ちゃんと読む</h1><div class=post-description>godoc コマンドを使ってドキュメントを読む方法についてまとめてみました</div><div class=post-meta>&lt;span title='2019-04-12 00:00:00 +0000 UTC'>2019-04-12&lt;/span>&amp;nbsp;·&amp;nbsp;6 min&amp;nbsp;·&amp;nbsp;2533 words&amp;nbsp;·&amp;nbsp;ayasuda</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#パッケージドキュメントを盛り盛りにする>パッケージドキュメントを盛り盛りにする</a></li><li><a href=#-notes-オプションで追加項目をリストアップする><code>-notes</code> オプションで追加項目をリストアップする</a></li><li><a href=#簡単なフォーマット>簡単なフォーマット</a></li><li><a href=#example-をつけるには>Example をつけるには</a></li></ul></nav></div></details></div><div class=post-content><p>Go 言語ではソースコード中にコメントを書くことで自動的に API ドキュメントを生成する方法が最初からサポートされています。</p><p><a href=https://blog.golang.org/godoc-documenting-go-code>Godoc: documenting Go code</a> でも、</p><blockquote><p>The Go project takes documentation seriously.</p></blockquote><p>と書かれているほど、しっかりと練られた文書化ツールが揃っています。</p><p>とはいえ、良い書き方や読み方がわからないと、書く気が起きませんよね？
そんなわけで、本文書では文書生成用のドキュメントの書き方と、それぞれのドキュメントの読み方について記していきます。</p><h1 id=godoc-の動きの確認>godoc の動きの確認<a hidden class=anchor aria-hidden=true href=#godoc-の動きの確認>#</a></h1><p>まず、サンプルコードを用意しましょう。</p><pre tabindex=0><code>$ mkdir -p $GOPATH/src/path/to/your/library
$ cd $GOPATH/src/path/to/youre/library
$ vim sample.go
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:sample.go data-lang=go:sample.go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>sample</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Foo</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Foo &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; ooF&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>PrintFoo</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>Foo</span>(<span style=color:#a6e22e>s</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>この段階で、すでに <code>godoc</code> コマンドからドキュメントを参照可能です</em></p><p>まずはブラウザから見てみましょう。<code>-http</code> オプションで、ドキュメントをみるための web サーバが起動できます。</p><pre tabindex=0><code>$ godoc -http=:8080
</code></pre><p>コマンドを実行したら <code>http://localhost:8080</code> にアクセスしてみましょう。まるで公式サイトのような Web ページが見られると思います。</p><p><img loading=lazy src=/img/introduction_go_doc/1.png alt></p><p>ヘッダの「Packages」リンクから、標準ライブラリおよび、<em>GOPATH に持ってきている全てのパッケージのドキュメント</em> が確認できます。
もちろん、たった今作った <code>sample.Foo</code> のドキュメントもあります！</p><p><img loading=lazy src=/img/introduction_go_doc/2.png alt></p><p>なお、この時の URL は <code>http://localhost:600/pkg/path/to/your/library/</code> になります。わかりやすいですね！</p><p><img loading=lazy src=/img/introduction_go_doc/3.png alt></p><h1 id=簡単なコメントを書く>簡単なコメントを書く<a hidden class=anchor aria-hidden=true href=#簡単なコメントを書く>#</a></h1><p>Godoc で読むためのコメントはとてもシンプルで、<code>godoc</code> がなくても読みたくなるようなコメントが書けるように意識して書くのが良いでしょう。Go Blog でも以下のように言及されています。</p><blockquote><p>Godoc comments are just good comments, the sort you would want to read even if godoc didn&rsquo;t exist.</p></blockquote><p>コメントは <code>type</code>, <code>variable</code>, <code>constant</code>, <code>function</code>, <code>package</code> に書くことができます。また、コメントには一つルールがあり、その要素名で始める必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:sample.go data-lang=go:sample.go><span style=display:flex><span><span style=color:#75715e>// sample パッケージはコメントの書き方と読み方の例を提供します。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>sample</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Bar はとある変数です
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Bar</span> = <span style=color:#e6db74>&#34;some variable&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Baz はとある定数です
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Baz</span> = <span style=color:#e6db74>&#34;some constant&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Qux はとある構造体です
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Qux</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// A には適当な文字列をどうぞ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>A</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// A にも適当な文字列をどうぞ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>B</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Foo はとりあえず前後に変な文字をくっけます
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Foo</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Foo &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; ooF&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// PrintFoo はとりあえず前後に変な文字をくっけます
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>PrintFoo</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>Foo</span>(<span style=color:#a6e22e>s</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こいつをブラウザで表示すると下記のようにいい感じに表示されます。</p><p><img loading=lazy src=/img/introduction_go_doc/4.png alt></p><h1 id=ブラウザ以外からドキュメントを読む>ブラウザ以外からドキュメントを読む<a hidden class=anchor aria-hidden=true href=#ブラウザ以外からドキュメントを読む>#</a></h1><p><code>godoc</code> のヘルプを見ればすぐにわかりますが、<code>godoc package [name]</code> でそのパッケージおよび各種項目のドキュメントがコマンドラインから読めます。</p><pre tabindex=0><code>$ godoc fmt Println
func Println(a ...interface{}) (n int, err error)
    Println formats using the default formats for its operands and writes to
    standard output. Spaces are always added between operands and a newline
    is appended. It returns the number of bytes written and any write error
    encountered.
</code></pre><p>自作のライブラリ含めたサードパーティのライブラリのドキュメントを読む場合は、パッケージをフルパスで書きましょう。先に作ったサンプルの場合なら次のようになります。</p><pre tabindex=0><code>godoc path/to/your/library PrintFoo
func PrintFoo(s string)
    PrintFoo はとりあえず前後に変な文字をくっけます
</code></pre><blockquote><p><em>Q: パッケージ名の <code>sample</code> はどこに行ったのでしょうか？</em></p><p>Answer: 僕がライブラリの作り方ミスって、sample が消失しただけだよ！ golang のライブラリの作り方はこの文書の範疇じゃないから仕方ないね！
(具体的には、パッケージ名とディレクトリ名は通常一致させるべき)</p></blockquote><h1 id=もっと詳しくドキュメントを書く>もっと詳しくドキュメントを書く<a hidden class=anchor aria-hidden=true href=#もっと詳しくドキュメントを書く>#</a></h1><p>ここまでで日常使いには十分ですが、さらに詳しく、いろいろ書きたい人向けの機能にもふれておきましょう。</p><h2 id=パッケージドキュメントを盛り盛りにする>パッケージドキュメントを盛り盛りにする<a hidden class=anchor aria-hidden=true href=#パッケージドキュメントを盛り盛りにする>#</a></h2><p>専門知識が必要なパッケージを作りたいときなどに、プログラム本体のコメントとしてドキュメントを書くとちょっと長くなるケースがあると思います。
そういう時はパッケージドキュメント専用のファイルを作ることができます。</p><p>具体的には、 <code>doc.go</code> というファイルを用意し、そこにパッケージのドキュメントを記述します。</p><p><a href=https://golang.org/pkg/encoding/gob/>gob パッケージ</a> では、この機能が使われており、ドキュメントは <a href=https://golang.org/src/encoding/gob/doc.go>src/encoding/gob/doc.go</a> に書かれています。</p><h2 id=-notes-オプションで追加項目をリストアップする><code>-notes</code> オプションで追加項目をリストアップする<a hidden class=anchor aria-hidden=true href=#-notes-オプションで追加項目をリストアップする>#</a></h2><p>基本的にコード中や指定箇所以外のコメントは無視されますが、<code>godoc</code> のノート機能を使うと、より多くのメタ情報を知るせます。</p><p>デフォルトでは <code>BUG(who)</code> が定義されているので、例えば、下記のようなコメントを書くと、godoc で見たときにひとまとまりに表示されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Foo はとりあえず前後に変な文字をくっけます
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// BUG(ayasuda) ごめん、なんかバグある気がする
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Foo</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Foo &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; ooF&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ブラウザで見ると下記のようになります。</p><p><img loading=lazy src=/img/introduction_go_doc/5.png alt></p><p>繰り返しになりますが、デフォルトでは <code>BUG</code> が定義されているので、コメント中で <code>BUG(who)</code> を記述可能です。<code>-notes</code> オプションでこの定義は自由に増やせます。</p><h2 id=簡単なフォーマット>簡単なフォーマット<a hidden class=anchor aria-hidden=true href=#簡単なフォーマット>#</a></h2><p>コメントを書く際に、以下のルールに従うとことで HTML 化した際のフォーマットを変更することができます。</p><ul><li>連続した行は一つの段落と見なされます<ul><li>段落を区切りたい場合は空白行を間に入れる必要があります</li></ul></li><li>英大文字で始まり、直前が句読点ではない単一行の段落は見出しになります</li><li>字下げすると整形済みテキストになります</li><li>URL はリンクになります</li></ul><p>そんなわけで、例えば、下記のようなコメントを書くと</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>ここはパッケージコメントの最初になるから見出しではないよー
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>Hで始まり単一行かつ句読点なしかつ前が見出しではないのでこれは見出し
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>段落段落
</span></span></span><span style=display:flex><span><span style=color:#75715e>段落段落
</span></span></span><span style=display:flex><span><span style=color:#75715e>段落段落
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>次の段落
</span></span></span><span style=display:flex><span><span style=color:#75715e>次の段落
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>	整形済みテキスt
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>次のやつはリンクになるはず。
</span></span></span><span style=display:flex><span><span style=color:#75715e>https://golang.org/
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>sample</span>
</span></span></code></pre></div><p>以下のようにHTML化されます。</p><p><img loading=lazy src=/img/introduction_go_doc/6.png alt></p><p>これ以上にいろいろ装飾したい場合は、 最悪、ソースが <a href=https://github.com/golang/tools/tree/master/godoc>ここ</a> にあるので・・・</p><h2 id=example-をつけるには>Example をつけるには<a hidden class=anchor aria-hidden=true href=#example-をつけるには>#</a></h2><p>公式ドキュメントのいくつかの関数では、 Example が付いてます。
これは <a href=https://blog.golang.org/examples>Testable Examples</a> を利用して作られています。</p><p>上記の <code>sample</code> パッケージに対して Testable Example を作るなら、まずは <code>/path/to/your/library/example_test.go</code> を用意します。
パッケージ名は <code>sample_test</code> としてください。</p><p>中には次のルールでサンプルがかけます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ExampleFoo</span>()     <span style=color:#75715e>// Foo 関数のサンプルコードになります
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ExampleBar_Qux</span>() <span style=color:#75715e>// Bar 構造体の Qux 関数のサンプルコードになります
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Example</span>()        <span style=color:#75715e>// パッケージ全体のサンプルコードになります
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ExampleFoo_foo</span>   <span style=color:#75715e>// Foo 関数のサンプルコード(fooの場合)
</span></span></span></code></pre></div><p>また、テストコード中に <code>Output:</code> から始まるコメントを記載することで、標準出力に書き込まれた値をチェックすることができます。</p><p>そんなわけで、こんなコードを書きます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:/path/to/your/library/example_test.go data-lang=go:/path/to/your/library/example_test.go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>sample_test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;path/to/your/library&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ExampleFoo</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>sample</span>.<span style=color:#a6e22e>Foo</span>(<span style=color:#e6db74>&#34;foo&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Output: Foo foo ooF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>テストはいつも通り、<code>go test</code> コマンドから実行可能です。</p><pre tabindex=0><code>$ go test
PASS
ok  path/to/your/library  0.004s
</code></pre><p>後は、ドキュメントを生成すると、Example が記載されているはずです。</p><p><img loading=lazy src=/img/introduction_go_doc/7.png alt></p><h1 id=参照>参照<a hidden class=anchor aria-hidden=true href=#参照>#</a></h1><ul><li><a href=https://blog.golang.org/godoc-documenting-go-code>Godoc: documenting Go code - The Go Blog</a></li><li><a href=https://godoc.org/golang.org/x/tools/cmd/godoc>godoc - GoDoc</a></li><li><a href=https://blog.golang.org/examples>Testable Examples in Go - The Go Blog</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://ayasuda.github.io/tags/go/>Go</a></li><li><a href=https://ayasuda.github.io/tags/tools/>Tools</a></li></ul><nav class=paginav><a class=prev href=https://ayasuda.github.io/pages/what_is_context_at_go/><span class=title>« Prev</span><br><span>Go 言語 context パッケージ誕生の背景と使用方法</span>
</a><a class=next href=https://ayasuda.github.io/pages/tipes_realtime_preview/><span class=title>Next »</span><br><span>PlantUML をリアルタイムでプレビューしたい - それ、fswatch でできるよ。</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ayasuda.github.io/>ayasuda.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>