<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ぼくのための Gradle 入門 | ayasuda.github.io</title>
<meta name=keywords content="Java,Gradle,Gradle入門"><meta name=description content="Gradle に入門しつつ、とりあえず Hello,World. と Java プログラムを書くまで"><meta name=author content="ayasuda"><link rel=canonical href=https://ayasuda.github.io/pages/introduction_gradle/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ayasuda.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ayasuda.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ayasuda.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ayasuda.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ayasuda.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ayasuda.github.io/pages/introduction_gradle/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ぼくのための Gradle 入門"><meta property="og:description" content="Gradle に入門しつつ、とりあえず Hello,World. と Java プログラムを書くまで"><meta property="og:type" content="article"><meta property="og:url" content="https://ayasuda.github.io/pages/introduction_gradle/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2018-08-01T00:00:00+00:00"><meta property="article:modified_time" content="2018-08-01T00:00:00+00:00"><meta property="og:site_name" content="ayasuda.gihtub.io"><meta name=twitter:card content="summary"><meta name=twitter:title content="ぼくのための Gradle 入門"><meta name=twitter:description content="Gradle に入門しつつ、とりあえず Hello,World. と Java プログラムを書くまで"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pages","item":"https://ayasuda.github.io/pages/"},{"@type":"ListItem","position":2,"name":"ぼくのための Gradle 入門","item":"https://ayasuda.github.io/pages/introduction_gradle/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ぼくのための Gradle 入門","name":"ぼくのための Gradle 入門","description":"Gradle に入門しつつ、とりあえず Hello,World. と Java プログラムを書くまで","keywords":["Java","Gradle","Gradle入門"],"articleBody":"Ruby な会社から Java な会社に転職したぼく。その前に立ちはだかるのは３つのビルドツールだった。 Java で一番新しいビルドツールは Gradle と聞いたぼくは、早速 Gradle の使い方について調べるのでした。\nWhat is Gradle とりあえず Java で Hello,World できるようなプログラムを考えましょう。 何も使用せずに生でソースコード (例えば HellWorld.java) を書き、 変更するたびに、コンパイル (javac HelloWorld.java) し、そして実行 (java HelloWorld.class) しても良いのですが、作業が煩雑です。 特に、プログラムが大きくなったあと、ライブラリを持ってきたり、ライブラリとリンクしたりするあたりや、コンパイルオプションが増え始めた後は面倒です。\nそこで登場するのがビルドツールで、Java の世界では長らく Ant が使われてきました。 ところがどっこいビルドスクリプトの肥大化や複雑化が大変になることが多く、管理コストが悩みのタネになりがちでした。（当たり前だけど使わないよりかははるかにマシではある） そこで出てきたのが Maven で、ビルドライフサイクルというよくある手順の形式化や依存関係の自動解決などが提供されとても流行しました。 しかし、暗黙の設定の多さや規約から外れようとした時の手間という弱点が薄々認知されれるようになったある日、 Gradle が登場したのです。\nGradle では Maven の良さを取り入れつつ、柔軟性を高めるためにスクリプトの記述言語に Groovy が採用されました。\nGradle ですぐにビルド・実行ができる、 Hello,World を表示する java アプリを作ろう さて、 Gradleの便利さ を試すために、素の Java と Gradle を使った場合とでどのように違うのか、実際にプログラムを書きながら見ていきましょう。 先ずは、何はともあれ “Hello,World.” を表示するプログラムを書いていきます。\nもちろん、単純なプログラムであれば Gradle を使った方が煩雑です。\nですが、この後に述べていく通り、複数ファイルで構成されるプログラムや、外部ライブラリを使うプログラムなら Gradle を使うメリットがはっきりわかるはずです。\n素の Java で書くとどうなる？ さて、素の Java プログラムで Hello,World. を表示するプログラムを書いてみましょう。ひとまず、ディレクトリを用意し、 git リポジトリを用意します。\n$ mkdir vanilla_java $ cd vanilla_java $ git init $ git commit --allow-emtpy -m 'Initial commit' そして、アプリケーションコードを作ってみましょう。とりあえず、 Application.java という名前にします。\npublic class Application { public static void main(String[] args) { System.out.println(\"Hello, World.\"); } } こいつをコンパイルして、クラスファイルを作り、実行してみましょう。うまくいけば、 Hello,World. と表示されるはずです。\n$ javac Application.java $ ls Application.class Application.java $ java Application Hello, World. 毎回正確なコマンドを打つのは面倒ですよね？　ですので、実行可能な jar ファイルを生成しておきましょう。\nまず、マニフェストファイルを作ります。このファイルの中には、どのクラスを最初に実行するかを記しておきます。\nManifest-Version: 1.0 Main-Class: Application 次に下記のコマンドでファイルをまとめます\n$ jar cvfm app.jar Manifest.txt Application.class これで app.jar というファイルができたはずです。この jar ファイルを java コマンドから実行すると、次のようにきちんと実行できるはずです。\n$ java -jar app.jar Hello, World. ここまでのコードは ayasuda/sandox/vannila_java にあります。\nGradle を使った Hello,World プロジェクト さて、上記と同じことを Gradle を使ってやっていきます。 まずは作業用ディレクトリを用意し、Gradle のビルドファイル、ついでに git リポジトリを用意しておきましょう。\n$ mkdir with_gradle $ cd with_gradle $ git init $ gradle init Gradle のウリとしてプラグイン機構があり java アプリであれば Gradle Java Plugin を組み込むことで、 いろんなタスクやその他諸々が自動で設定されます。(ただし規約に従う必要がある) そんなわけで gradle init で生成された build.gradle に次の１行を足します。\napply plugin: 'java' Gradle Java Plugin は、デフォルトで src/main/java に java のソースが置かれているものとしてコンパイルタスクなどが組まれています。 ですので、今回作るアプリの Main クラスを src/main/java/パッケージ名/ 以下に置くことにしましょう。 ひとまず、パッケージ名を with_gradle として以下のようにディレクトリとファイルを作ります。\n$ mkdir -p src/main/java/with_gradle $ vim src/main/java/with_gradle/Application.java 今回は “Hello,World.” と表示するだけのプログラムなので、 内容は以下のとおりです。\npackage with_gradle; public class Application { public static void main(String[] args) { System.out.println(\"Hello, World\"); } } プログラムを書いたら早速ビルドして…\n$ ./gradlew build そして、実行してみましょう。 ビルドをすることで Application.class が build/classes/jaav/main 以下にできたはずです。 ですので、 -classpath オプションを指定して実行します。\n$ java -classpath ./build/classes/java/main with_gradle.Application Hello, World しかし、毎回クラスパスを指定するのは面倒です。ですので、簡単に実行できるように jar ファイルを作りましょう。 実行可能な jar ファイルを作るためにはマニフェストが必要でした。 gradle を使う場合、方法は次の３通りです。\n自分でマニフェストファイルを書いて、実行可能な jar ができるようにする Gradle Java Plugin の manifest file プロパティを指定して、実行可能な java ができるようにする Gradle Applicatoin Plugin を使う 自分でマニフェストファイルを書く方法についてはよくわからなかったので、ここでは 2, 3 についてみて行きましょう。\nGradle Java Plugin の jar オブジェクトには manifest プロパティがあり、そこで値を設定することで、 jar タスクにてパッケージする際の MANIFEST.MF の内容を設定できます。 今回は、 Main-Class を with_gradle.Application にしたいので、 build.gradle を下記のように書き換えます。\napply plugin: 'java' jar { manifest { attributes('Main-Class': 'with_gradle.Application') } } 書き換えたら早速ビルドしてみましょう。\n$ ./gradlew build これにより、正しく Main-Class が設定されたマニフェストファイルを含んだ jar ファイルが build/libs/ 以下にできたはずです。 と、いうわけで実行してみましょう。\n$ java -jar build/libs/with_jar.jar Hello, World. なお、 jar ファイルの名前は jar.baseName で変更可能です。\napply plugin: 'java' jar { baseName = 'app' manifest { attributes('Main-Class': 'what_is_context.Hello') } } 単に実行をしたいだけならば Application Plugin を使うのが最も簡単です。 このプラグインを読み込んで、 mainClassName 属性を設定することで、アプリケーションを実行する run タスクが使えるようになります。\napply plugin: 'java' apply plugin: 'application' mainClassName = 'what_is_context.Hello' 上記の様にファイルを変更すれば、下記の様に run タスクを実行するだけです。\n$ ./gradlew run Hello, World ここまでのソースコードは TODO で確認できます。\n2 つのファイルに別れた Java アプリ ここまでの話では、 Gradle を使うメリットなんて感じられない と思います。煩雑になっただけにしか見えないかと思います。 ですが、実際のプログラミングでは1ファイルで済むことはあまりありませんし、外部のライブラリを使わないこともあまりありません。 次に、バニラと Gradle を使った場合とで複数ファイルのプログラミングはどのように違うのかをみていきたいと思います。\n素の Java で書くと？ まず、 Hello, World. の文字列を別のクラスから取得するようにしましょう。特に、面倒臭く それっぽくするために、ディレクトリを切ってその下にクラスを置くようにしてみましょう。\npackage generators; public class GreetingMessageGenerator { public String generate() { return \"Hello, World.\"; } } import generators.GreetingMessageGenerator; public class Application { public static void main(String[] args) { String message = new GreetingMessageGenerator().generate(); System.out.println(message); } } この２つのクラスをそれぞれコンパイルしてみましょう。\n$ javac Application.java generators/GreetingMessageGenerator.java $ java Application そしてパッケージ化します\n$ jar cvfm app.jar Application.class generators/GreetingMessageGenerator.class $ java -jar app.jar ここまでなら先ほどまでとそこまで変わらないから大丈夫ですよね？？\nさて、次にメッセージを書き換えてみましょう。\npackage generators; public class GreetingMessageGenerator { public String generate() { return \"Hello, Java.\"; } } 書き換えたのは GreetingMessageGenerator.java だけなので、コンパイルし直すのはそのファイルだけです。\n$ javac generators/GreetingMessageGenerator.java $ java Application Hello, World. パッケージの中のクラスファイルも更新する必要があります。\n$ jar -uf app.jar generators/GreetingMessageGenerator.class $ java -jar app.jar Hello, World. 複数ファイルのプログラムでは、ファイルを更新するごとにこの処理が必要になります。 もちろん、毎回全てのファイルをコンパイルし直しやパッケージの作り直しをしてもかまいませんが、プログラムのサイズが大きくなればなるほど時間がかかるようになってしまいます。\nGradle を使った場合 Gradle を使ったプロジェクトも同様にしましょう。ディレクトリは全て src/main/java/with_gradle 以下に作りましょう。\npackage generators; public class GreetingMessageGenerator { public String generate() { return \"Hello, World.\"; } } import generators.GreetingMessageGenerator; public class Application { public static void main(String[] args) { String message = new GreetingMessageGenerator().generate(); System.out.println(message); } } さて、ビルドや実行手順はファイルが１つだろうが複数だろうが、変わりません。\n$ ./gradlew build $ java -jar build/libs/app.jar Hello, World. $ ./gradlew run Hello, World. また、更新されていないプログラムは無駄にコンパイルされないなど、便利な機能がいっぱいです！\n外部のライブラリを使う Java アプリ よくある処理はライブラリにまとめられていることがほとんどです。例えば、yaml のパースをするなら SnakeYAML などがあります。 次に、素の Java と Gradle を使った場合とでライブラリを用いたプログラムの比較をしてみましょう。\n素の Java で書くと？ まず、素の java プログラムを書くのであれば、ライブラリをダウンロードしてくる必要があります。 ひとまず SnakeYAML の最新版は https://repo1.maven.org/maven2/org/yaml/snakeyaml/1.21/snakeyaml-1.21.jar にあります。\n$ cd path/to/vanilla_java $ wget https://repo1.maven.org/maven2/org/yaml/snakeyaml/1.21/snakeyaml-1.21.jar さて、このライブラリファイルですが、基本的には git 管理しません。 なぜ管理しないかは色々あるのですが、簡単にいうと\n外部ライブラリのバージョン管理は外部ライブラリ側でやるので自前でバージョン管理する必要はない git リポジトリが肥大化するので避けたい みたいな理由です。\nさて、早速このライブラリを使ったクラスを作成し、 Application.java からそれを使うように修正してみましょう。\npackage generators; import org.yaml.snakeyaml.Yaml; public class YamlMessageGenerator { public String generate() { String document = \"message: Hello, YAML\"; Yaml yaml = new Yaml(); Message message = (Message) yaml.loadAs(document, Message.class); return message; } public static class Message { String message; public String getMessage() { return this.message; } public void setMessage(String message) { this.message = message; } } } import generators.YamlMessageGenerator; public class Application { public static void main(String[] args) { String message = new YamlMessageGenerator().generate(); System.out.println(message); } } このプログラムをコンパイル・実行するときには、クラスパスにカレントディレクトリとライブラリとを指定する必要があります。\n$ javac -classpath .:snakeyaml-1.21.jar Application.java $ java -classpath .:snakeyaml-1.21.jar Application また、jar ファイルにまとめるときには Class-Path をマニフェストに設定する必要があります。\nManifest-Version: 1.0 Main-Class: Application Class-Path: snakeyaml-1.21.jar jar にまとめた後、app.jar と snakeyaml-1.21.jar とが同じディレクトリにあるときに実行可能です。\n$ jar cvfm app.jar Manifest.text Application.class generators/*.class $ java -jar app.jar もちろん、使用するライブラリが増えれば増えるほど、クラスパスへの追加が増えていきますし、使用するライブラリのバージョン管理も大変です。\nGradle を使った場合 Gradle を使っていれば、もう少し話は簡単になります。\n先ずはソースコードを用意しましょう。\npackage with_gradle.generators; import org.yaml.snakeyaml.Yaml; public class YamlMessageGenerator { public String generate() { String document = \"message: Hello, YAML\"; Yaml yaml = new Yaml(); Message message = (Message) yaml.loadAs(document, Message.class); return message; } public static class Message { String message; public String getMessage() { return this.message; } public void setMessage(String message) { this.message = message; } } } import with_gradle.generators.YamlMessageGenerator; public class Application { public static void main(String[] args) { String message = new YamlMessageGenerator().generate(); System.out.println(message); } } 次に、Gradle のビルドファイルに、外部ライブラリへの依存関係を記します。\nついでに、Fat-Jar (依存するライブラリなども全て含めた jar ファイル) を作るための Shadow Plugin も導入します。\n// Gradle でのビルド中に Shadow プラグインを使う buildscript { repositories { jcenter() } dependencies { classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.4' } } apply plugin: 'java' apply plugin: 'application' apply plugin: 'com.github.johnrengelman.shadow' mainClassName = 'with_gradle.Application' jar { manifest { baseName = 'app' attributes('Main-Class': mainClassName) } } // ライブラリを Maven リポジトリから取得する repositories { mavenCentral() } // 依存関係として snakeyaml の 1.21 を追加する dependencies { compile group: 'org.yaml', name: 'snakeyaml', version: '1.21' } さて準備ができたら早速ビルドしてみます。\n$ ./gradlew build $ java -jar build/libs/with_gradle-all.jar # fat-jar になっているので、直接実行できます Hello, YAML $ ./gradlew run Hello, YAML この後は、使用するライブラリが増えてもビルドスクリプトに追加するだけで済みますし、また、使用するライブラリのバージョンも明記されており、管理が簡単です。\nここまでのコードは ayasuda/sandox/with_gradle にあります。\nまとめ ここまで Gradle を使った場合と使わないで手作業でやった場合とで Java プログラムの書き方を比較して見ましたがいかがでしょうか？ みなさんも、ぜひ Gradle を使って見てください。\n","wordCount":"4332","inLanguage":"en","datePublished":"2018-08-01T00:00:00Z","dateModified":"2018-08-01T00:00:00Z","author":{"@type":"Person","name":"ayasuda"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ayasuda.github.io/pages/introduction_gradle/"},"publisher":{"@type":"Organization","name":"ayasuda.github.io","logo":{"@type":"ImageObject","url":"https://ayasuda.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ayasuda.github.io/ accesskey=h title="ayasuda.github.io (Alt + H)">ayasuda.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://ayasuda.github.io/pages/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ayasuda.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ayasuda.github.io/pages/>Pages</a></div><h1 class=post-title>ぼくのための Gradle 入門</h1><div class=post-description>Gradle に入門しつつ、とりあえず Hello,World. と Java プログラムを書くまで</div><div class=post-meta>&lt;span title='2018-08-01 00:00:00 +0000 UTC'>2018-08-01&lt;/span>&amp;nbsp;·&amp;nbsp;9 min&amp;nbsp;·&amp;nbsp;4332 words&amp;nbsp;·&amp;nbsp;ayasuda</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#素の-java-で書くとどうなる>素の Java で書くとどうなる？</a></li><li><a href=#gradle-を使った-helloworld-プロジェクト>Gradle を使った Hello,World プロジェクト</a></li></ul><ul><li><a href=#素の-java-で書くと>素の Java で書くと？</a></li><li><a href=#gradle-を使った場合>Gradle を使った場合</a></li></ul><ul><li><a href=#素の-java-で書くと-1>素の Java で書くと？</a></li><li><a href=#gradle-を使った場合-1>Gradle を使った場合</a></li></ul></nav></div></details></div><div class=post-content><p>Ruby な会社から Java な会社に転職したぼく。その前に立ちはだかるのは３つのビルドツールだった。
Java で一番新しいビルドツールは Gradle と聞いたぼくは、早速 Gradle の使い方について調べるのでした。</p><h1 id=what-is-gradle>What is Gradle<a hidden class=anchor aria-hidden=true href=#what-is-gradle>#</a></h1><p>とりあえず Java で Hello,World できるようなプログラムを考えましょう。
何も使用せずに生でソースコード (例えば <code>HellWorld.java</code>) を書き、 変更するたびに、コンパイル (<code>javac HelloWorld.java</code>) し、そして実行 (<code>java HelloWorld.class</code>) しても良いのですが、作業が煩雑です。
特に、プログラムが大きくなったあと、ライブラリを持ってきたり、ライブラリとリンクしたりするあたりや、コンパイルオプションが増え始めた後は面倒です。</p><p>そこで登場するのがビルドツールで、Java の世界では長らく <a href=https://ant.apache.org>Ant</a> が使われてきました。
ところがどっこいビルドスクリプトの肥大化や複雑化が大変になることが多く、管理コストが悩みのタネになりがちでした。（当たり前だけど使わないよりかははるかにマシではある）
そこで出てきたのが <a href=https://maven.apache.org>Maven</a> で、ビルドライフサイクルというよくある手順の形式化や依存関係の自動解決などが提供されとても流行しました。
しかし、暗黙の設定の多さや規約から外れようとした時の手間という弱点が薄々認知されれるようになったある日、 <a href=https://gradle.org/>Gradle</a> が登場したのです。</p><p>Gradle では Maven の良さを取り入れつつ、柔軟性を高めるためにスクリプトの記述言語に Groovy が採用されました。</p><h1 id=gradle-ですぐにビルド実行ができる-helloworld-を表示する-java-アプリを作ろう>Gradle ですぐにビルド・実行ができる、 Hello,World を表示する java アプリを作ろう<a hidden class=anchor aria-hidden=true href=#gradle-ですぐにビルド実行ができる-helloworld-を表示する-java-アプリを作ろう>#</a></h1><p>さて、 <em>Gradleの便利さ</em> を試すために、素の Java と Gradle を使った場合とでどのように違うのか、実際にプログラムを書きながら見ていきましょう。
先ずは、何はともあれ &ldquo;Hello,World.&rdquo; を表示するプログラムを書いていきます。</p><p>もちろん、単純なプログラムであれば Gradle を使った方が煩雑です。</p><p>ですが、この後に述べていく通り、複数ファイルで構成されるプログラムや、外部ライブラリを使うプログラムなら Gradle を使うメリットがはっきりわかるはずです。</p><h2 id=素の-java-で書くとどうなる>素の Java で書くとどうなる？<a hidden class=anchor aria-hidden=true href=#素の-java-で書くとどうなる>#</a></h2><p>さて、素の Java プログラムで Hello,World. を表示するプログラムを書いてみましょう。ひとまず、ディレクトリを用意し、 git リポジトリを用意します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ mkdir vanilla_java
</span></span><span style=display:flex><span>$ cd vanilla_java
</span></span><span style=display:flex><span>$ git init
</span></span><span style=display:flex><span>$ git commit --allow-emtpy -m <span style=color:#e6db74>&#39;Initial commit&#39;</span>
</span></span></code></pre></div><p>そして、アプリケーションコードを作ってみましょう。とりあえず、 Application.java という名前にします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:Application.java data-lang=java:Application.java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Hello, World.&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こいつをコンパイルして、クラスファイルを作り、実行してみましょう。うまくいけば、 Hello,World. と表示されるはずです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ javac Application.java
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>Application.class Application.java
</span></span><span style=display:flex><span>$ java Application
</span></span><span style=display:flex><span>Hello, World.
</span></span></code></pre></div><p>毎回正確なコマンドを打つのは面倒ですよね？　ですので、実行可能な jar ファイルを生成しておきましょう。</p><p>まず、マニフェストファイルを作ります。このファイルの中には、どのクラスを最初に実行するかを記しておきます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text:Manifest.txt data-lang=text:Manifest.txt><span style=display:flex><span>Manifest-Version: 1.0
</span></span><span style=display:flex><span>Main-Class: Application
</span></span></code></pre></div><p>次に下記のコマンドでファイルをまとめます</p><pre tabindex=0><code>$ jar cvfm app.jar Manifest.txt Application.class
</code></pre><p>これで <code>app.jar</code> というファイルができたはずです。この jar ファイルを java コマンドから実行すると、次のようにきちんと実行できるはずです。</p><pre tabindex=0><code>$ java -jar app.jar
Hello, World.
</code></pre><p>ここまでのコードは <a href=https://github.com/ayasuda/sandbox/tree/master/vanilla_java>ayasuda/sandox/vannila_java</a> にあります。</p><h2 id=gradle-を使った-helloworld-プロジェクト>Gradle を使った Hello,World プロジェクト<a hidden class=anchor aria-hidden=true href=#gradle-を使った-helloworld-プロジェクト>#</a></h2><p>さて、上記と同じことを Gradle を使ってやっていきます。
まずは作業用ディレクトリを用意し、Gradle のビルドファイル、ついでに git リポジトリを用意しておきましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ mkdir with_gradle
</span></span><span style=display:flex><span>$ cd with_gradle
</span></span><span style=display:flex><span>$ git init
</span></span><span style=display:flex><span>$ gradle init
</span></span></code></pre></div><p>Gradle のウリとしてプラグイン機構があり java アプリであれば <a href=https://docs.gradle.org/current/userguide/java_plugin.html>Gradle Java Plugin</a> を組み込むことで、
いろんなタスクやその他諸々が自動で設定されます。(ただし規約に従う必要がある)
そんなわけで <code>gradle init</code> で生成された <code>build.gradle</code> に次の１行を足します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy:build.gradle data-lang=groovy:build.gradle><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span></code></pre></div><p>Gradle Java Plugin は、デフォルトで <code>src/main/java</code> に java のソースが置かれているものとしてコンパイルタスクなどが組まれています。
ですので、今回作るアプリの Main クラスを <code>src/main/java/パッケージ名/</code> 以下に置くことにしましょう。
ひとまず、パッケージ名を with_gradle として以下のようにディレクトリとファイルを作ります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ mkdir -p src/main/java/with_gradle
</span></span><span style=display:flex><span>$ vim src/main/java/with_gradle/Application.java
</span></span></code></pre></div><p>今回は &ldquo;Hello,World.&rdquo; と表示するだけのプログラムなので、
内容は以下のとおりです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:src/main/java/with_gradle/Application.java data-lang=java:src/main/java/with_gradle/Application.java><span style=display:flex><span><span style=color:#f92672>package</span> with_gradle;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Hello, World&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>プログラムを書いたら早速ビルドして&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ ./gradlew build
</span></span></code></pre></div><p>そして、実行してみましょう。
ビルドをすることで <code>Application.class</code> が <code>build/classes/jaav/main</code> 以下にできたはずです。
ですので、 <code>-classpath</code> オプションを指定して実行します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ java -classpath ./build/classes/java/main with_gradle.Application
</span></span><span style=display:flex><span>Hello, World
</span></span></code></pre></div><p>しかし、毎回クラスパスを指定するのは面倒です。ですので、簡単に実行できるように jar ファイルを作りましょう。
実行可能な jar ファイルを作るためにはマニフェストが必要でした。 gradle を使う場合、方法は次の３通りです。</p><ol><li>自分でマニフェストファイルを書いて、実行可能な jar ができるようにする</li><li>Gradle Java Plugin の manifest file プロパティを指定して、実行可能な java ができるようにする</li><li>Gradle Applicatoin Plugin を使う</li></ol><p>自分でマニフェストファイルを書く方法についてはよくわからなかったので、ここでは 2, 3 についてみて行きましょう。</p><p>Gradle Java Plugin の jar オブジェクトには manifest プロパティがあり、そこで値を設定することで、
jar タスクにてパッケージする際の <code>MANIFEST.MF</code> の内容を設定できます。
今回は、 <code>Main-Class</code> を <code>with_gradle.Application</code> にしたいので、 <code>build.gradle</code> を下記のように書き換えます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-buidl.gradle data-lang=buidl.gradle><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jar <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  manifest <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    attributes<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Main-Class&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;with_gradle.Application&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>書き換えたら早速ビルドしてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ ./gradlew build
</span></span></code></pre></div><p>これにより、正しく Main-Class が設定されたマニフェストファイルを含んだ jar ファイルが <code>build/libs/</code> 以下にできたはずです。
と、いうわけで実行してみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ java -jar build/libs/with_jar.jar
</span></span><span style=display:flex><span>Hello, World.
</span></span></code></pre></div><p>なお、 jar ファイルの名前は <code>jar.baseName</code> で変更可能です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-buidl.gradle data-lang=buidl.gradle><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jar <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  baseName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;app&#39;</span>
</span></span><span style=display:flex><span>  manifest <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    attributes<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Main-Class&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;what_is_context.Hello&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>単に実行をしたいだけならば <a href=https://docs.gradle.org/current/userguide/application_plugin.html>Application Plugin</a> を使うのが最も簡単です。
このプラグインを読み込んで、 <code>mainClassName</code> 属性を設定することで、アプリケーションを実行する <code>run</code> タスクが使えるようになります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-buidl.gradle data-lang=buidl.gradle><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;application&#39;</span>
</span></span><span style=display:flex><span>mainClassName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;what_is_context.Hello&#39;</span>
</span></span></code></pre></div><p>上記の様にファイルを変更すれば、下記の様に <code>run</code> タスクを実行するだけです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ ./gradlew run
</span></span><span style=display:flex><span>Hello, World
</span></span></code></pre></div><p>ここまでのソースコードは TODO で確認できます。</p><h1 id=2-つのファイルに別れた-java-アプリ>2 つのファイルに別れた Java アプリ<a hidden class=anchor aria-hidden=true href=#2-つのファイルに別れた-java-アプリ>#</a></h1><p>ここまでの話では、 <em>Gradle を使うメリットなんて感じられない</em> と思います。煩雑になっただけにしか見えないかと思います。
ですが、実際のプログラミングでは1ファイルで済むことはあまりありませんし、外部のライブラリを使わないこともあまりありません。
次に、バニラと Gradle を使った場合とで複数ファイルのプログラミングはどのように違うのかをみていきたいと思います。</p><h2 id=素の-java-で書くと>素の Java で書くと？<a hidden class=anchor aria-hidden=true href=#素の-java-で書くと>#</a></h2><p>まず、 Hello, World. の文字列を別のクラスから取得するようにしましょう。特に、<del>面倒臭く</del> それっぽくするために、ディレクトリを切ってその下にクラスを置くようにしてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:generators/GreetingMessageGenerator.java data-lang=java:generators/GreetingMessageGenerator.java><span style=display:flex><span><span style=color:#f92672>package</span> generators;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingMessageGenerator</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello, World.&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:Application.java data-lang=java:Application.java><span style=display:flex><span><span style=color:#f92672>import</span> generators.GreetingMessageGenerator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GreetingMessageGenerator().<span style=color:#a6e22e>generate</span>();
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>この２つのクラスをそれぞれコンパイルしてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ javac Application.java generators/GreetingMessageGenerator.java
</span></span><span style=display:flex><span>$ java Application
</span></span></code></pre></div><p>そしてパッケージ化します</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ jar cvfm app.jar Application.class generators/GreetingMessageGenerator.class
</span></span><span style=display:flex><span>$ java -jar app.jar
</span></span></code></pre></div><p>ここまでなら先ほどまでとそこまで変わらないから大丈夫ですよね？？</p><p>さて、次にメッセージを書き換えてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:generators/GreetingMessageGenerator.java data-lang=java:generators/GreetingMessageGenerator.java><span style=display:flex><span><span style=color:#f92672>package</span> generators;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingMessageGenerator</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello, Java.&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>書き換えたのは GreetingMessageGenerator.java だけなので、コンパイルし直すのはそのファイルだけです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ javac generators/GreetingMessageGenerator.java
</span></span><span style=display:flex><span>$ java Application
</span></span><span style=display:flex><span>Hello, World.
</span></span></code></pre></div><p>パッケージの中のクラスファイルも更新する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ jar -uf app.jar generators/GreetingMessageGenerator.class
</span></span><span style=display:flex><span>$ java -jar app.jar
</span></span><span style=display:flex><span>Hello, World.
</span></span></code></pre></div><p>複数ファイルのプログラムでは、ファイルを更新するごとにこの処理が必要になります。
もちろん、毎回全てのファイルをコンパイルし直しやパッケージの作り直しをしてもかまいませんが、プログラムのサイズが大きくなればなるほど時間がかかるようになってしまいます。</p><h2 id=gradle-を使った場合>Gradle を使った場合<a hidden class=anchor aria-hidden=true href=#gradle-を使った場合>#</a></h2><p>Gradle を使ったプロジェクトも同様にしましょう。ディレクトリは全て <code>src/main/java/with_gradle</code> 以下に作りましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:src/main/java/with_gradle/generators/GreetingMessageGenerator.java data-lang=java:src/main/java/with_gradle/generators/GreetingMessageGenerator.java><span style=display:flex><span><span style=color:#f92672>package</span> generators;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingMessageGenerator</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello, World.&#34;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:src/main/java/with_gradle/Application.java data-lang=java:src/main/java/with_gradle/Application.java><span style=display:flex><span><span style=color:#f92672>import</span> generators.GreetingMessageGenerator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GreetingMessageGenerator().<span style=color:#a6e22e>generate</span>();
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>さて、ビルドや実行手順はファイルが１つだろうが複数だろうが、変わりません。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ ./gradlew build
</span></span><span style=display:flex><span>$ java -jar build/libs/app.jar
</span></span><span style=display:flex><span>Hello, World.
</span></span><span style=display:flex><span>$ ./gradlew run
</span></span><span style=display:flex><span>Hello, World.
</span></span></code></pre></div><p>また、更新されていないプログラムは無駄にコンパイルされないなど、便利な機能がいっぱいです！</p><h1 id=外部のライブラリを使う-java-アプリ>外部のライブラリを使う Java アプリ<a hidden class=anchor aria-hidden=true href=#外部のライブラリを使う-java-アプリ>#</a></h1><p>よくある処理はライブラリにまとめられていることがほとんどです。例えば、yaml のパースをするなら <a href=https://bitbucket.org/asomov/snakeyaml/wiki/Documentation>SnakeYAML</a> などがあります。
次に、素の Java と Gradle を使った場合とでライブラリを用いたプログラムの比較をしてみましょう。</p><h2 id=素の-java-で書くと-1>素の Java で書くと？<a hidden class=anchor aria-hidden=true href=#素の-java-で書くと-1>#</a></h2><p>まず、素の java プログラムを書くのであれば、ライブラリをダウンロードしてくる必要があります。
ひとまず SnakeYAML の最新版は <a href=https://repo1.maven.org/maven2/org/yaml/snakeyaml/1.21/snakeyaml-1.21.jar>https://repo1.maven.org/maven2/org/yaml/snakeyaml/1.21/snakeyaml-1.21.jar</a> にあります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ cd path/to/vanilla_java
</span></span><span style=display:flex><span>$ wget https://repo1.maven.org/maven2/org/yaml/snakeyaml/1.21/snakeyaml-1.21.jar
</span></span></code></pre></div><p>さて、このライブラリファイルですが、基本的には git 管理しません。
なぜ管理しないかは色々あるのですが、簡単にいうと</p><ul><li>外部ライブラリのバージョン管理は外部ライブラリ側でやるので自前でバージョン管理する必要はない</li><li>git リポジトリが肥大化するので避けたい</li></ul><p>みたいな理由です。</p><p>さて、早速このライブラリを使ったクラスを作成し、 Application.java からそれを使うように修正してみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:src/main/java/with_gradle/generators/YamlMessageGenerator.java data-lang=java:src/main/java/with_gradle/generators/YamlMessageGenerator.java><span style=display:flex><span><span style=color:#f92672>package</span> generators;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.yaml.snakeyaml.Yaml;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YamlMessageGenerator</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generate</span>() {
</span></span><span style=display:flex><span>    String document <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;message: Hello, YAML&#34;</span>;
</span></span><span style=display:flex><span>    Yaml yaml <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Yaml();
</span></span><span style=display:flex><span>    Message message <span style=color:#f92672>=</span> (Message) yaml.<span style=color:#a6e22e>loadAs</span>(document, Message.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> message;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Message</span> {
</span></span><span style=display:flex><span>    String message;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getMessage</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setMessage</span>(String message) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> message;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:Application.java data-lang=java:Application.java><span style=display:flex><span><span style=color:#f92672>import</span> generators.YamlMessageGenerator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> YamlMessageGenerator().<span style=color:#a6e22e>generate</span>();
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このプログラムをコンパイル・実行するときには、クラスパスにカレントディレクトリとライブラリとを指定する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ javac -classpath .:snakeyaml-1.21.jar Application.java
</span></span><span style=display:flex><span>$ java -classpath .:snakeyaml-1.21.jar Application
</span></span></code></pre></div><p>また、jar ファイルにまとめるときには Class-Path をマニフェストに設定する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Manifest.txt data-lang=Manifest.txt><span style=display:flex><span>Manifest-Version: 1.0
</span></span><span style=display:flex><span>Main-Class: Application
</span></span><span style=display:flex><span>Class-Path: snakeyaml-1.21.jar
</span></span></code></pre></div><p>jar にまとめた後、app.jar と snakeyaml-1.21.jar とが同じディレクトリにあるときに実行可能です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ jar cvfm app.jar Manifest.text Application.class generators/*.class
</span></span><span style=display:flex><span>$ java -jar app.jar
</span></span></code></pre></div><p>もちろん、使用するライブラリが増えれば増えるほど、クラスパスへの追加が増えていきますし、使用するライブラリのバージョン管理も大変です。</p><h2 id=gradle-を使った場合-1>Gradle を使った場合<a hidden class=anchor aria-hidden=true href=#gradle-を使った場合-1>#</a></h2><p>Gradle を使っていれば、もう少し話は簡単になります。</p><p>先ずはソースコードを用意しましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:gererators/YamlMessageGenerator.java data-lang=java:gererators/YamlMessageGenerator.java><span style=display:flex><span><span style=color:#f92672>package</span> with_gradle.generators;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.yaml.snakeyaml.Yaml;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>YamlMessageGenerator</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generate</span>() {
</span></span><span style=display:flex><span>    String document <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;message: Hello, YAML&#34;</span>;
</span></span><span style=display:flex><span>    Yaml yaml <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Yaml();
</span></span><span style=display:flex><span>    Message message <span style=color:#f92672>=</span> (Message) yaml.<span style=color:#a6e22e>loadAs</span>(document, Message.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> message;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Message</span> {
</span></span><span style=display:flex><span>    String message;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getMessage</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setMessage</span>(String message) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> message;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java:src/main/java/with_gradle/Application.java data-lang=java:src/main/java/with_gradle/Application.java><span style=display:flex><span><span style=color:#f92672>import</span> with_gradle.generators.YamlMessageGenerator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> YamlMessageGenerator().<span style=color:#a6e22e>generate</span>();
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>次に、Gradle のビルドファイルに、外部ライブラリへの依存関係を記します。</p><p>ついでに、Fat-Jar (依存するライブラリなども全て含めた jar ファイル) を作るための <a href=http://imperceptiblethoughts.com/shadow/>Shadow Plugin</a> も導入します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy:build.gradle data-lang=groovy:build.gradle><span style=display:flex><span><span style=color:#75715e>// Gradle でのビルド中に Shadow プラグインを使う
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>buildscript <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    jcenter<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    classpath <span style=color:#e6db74>&#39;com.github.jengelman.gradle.plugins:shadow:2.0.4&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;application&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;com.github.johnrengelman.shadow&#39;</span>
</span></span><span style=display:flex><span>mainClassName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;with_gradle.Application&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jar <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  manifest <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    baseName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;app&#39;</span>
</span></span><span style=display:flex><span>    attributes<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Main-Class&#39;</span><span style=color:#f92672>:</span> mainClassName<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ライブラリを Maven リポジトリから取得する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 依存関係として snakeyaml の 1.21 を追加する
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  compile group: <span style=color:#e6db74>&#39;org.yaml&#39;</span><span style=color:#f92672>,</span> name: <span style=color:#e6db74>&#39;snakeyaml&#39;</span><span style=color:#f92672>,</span> version: <span style=color:#e6db74>&#39;1.21&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>さて準備ができたら早速ビルドしてみます。</p><pre tabindex=0><code>$ ./gradlew build
$ java -jar build/libs/with_gradle-all.jar # fat-jar になっているので、直接実行できます
Hello, YAML
$ ./gradlew run
Hello, YAML
</code></pre><p>この後は、使用するライブラリが増えてもビルドスクリプトに追加するだけで済みますし、また、使用するライブラリのバージョンも明記されており、管理が簡単です。</p><p>ここまでのコードは <a href=https://github.com/ayasuda/sandbox/tree/master/with_gradle>ayasuda/sandox/with_gradle</a> にあります。</p><h1 id=まとめ>まとめ<a hidden class=anchor aria-hidden=true href=#まとめ>#</a></h1><p>ここまで Gradle を使った場合と使わないで手作業でやった場合とで Java プログラムの書き方を比較して見ましたがいかがでしょうか？
みなさんも、ぜひ Gradle を使って見てください。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ayasuda.github.io/tags/java/>Java</a></li></ul><nav class=paginav><a class=prev href=https://ayasuda.github.io/pages/tipes_realtime_preview/><span class=title>« Prev</span><br><span>PlantUML をリアルタイムでプレビューしたい - それ、fswatch でできるよ。</span>
</a><a class=next href=https://ayasuda.github.io/pages/art_of_job_hopping_ayasuda_edition/><span class=title>Next »</span><br><span>アート・オブ・ジョブホッピング・ayasuda エディション</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ayasuda.github.io/>ayasuda.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>