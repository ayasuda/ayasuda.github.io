<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ぼくのための Generics (Go 言語) 入門 | ayasuda.github.io</title>
<meta name=keywords content="Go 言語,Generics,Generic Programming"><meta name=description content="Genercis がなぜ欲しいのか？　とその基本的な構文について"><meta name=author content="ayasuda"><link rel=canonical href=https://ayasuda.github.io/pages/introduction_go_generics/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://ayasuda.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ayasuda.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ayasuda.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ayasuda.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ayasuda.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ayasuda.github.io/pages/introduction_go_generics/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ぼくのための Generics (Go 言語) 入門"><meta property="og:description" content="Genercis がなぜ欲しいのか？　とその基本的な構文について"><meta property="og:type" content="article"><meta property="og:url" content="https://ayasuda.github.io/pages/introduction_go_generics/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2024-07-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-24T00:00:00+00:00"><meta property="og:site_name" content="ayasuda.gihtub.io"><meta name=twitter:card content="summary"><meta name=twitter:title content="ぼくのための Generics (Go 言語) 入門"><meta name=twitter:description content="Genercis がなぜ欲しいのか？　とその基本的な構文について"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pages","item":"https://ayasuda.github.io/pages/"},{"@type":"ListItem","position":2,"name":"ぼくのための Generics (Go 言語) 入門","item":"https://ayasuda.github.io/pages/introduction_go_generics/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ぼくのための Generics (Go 言語) 入門","name":"ぼくのための Generics (Go 言語) 入門","description":"Genercis がなぜ欲しいのか？　とその基本的な構文について","keywords":["Go 言語","Generics","Generic Programming"],"articleBody":"なぜプログラミング言語に Generics 機能が必要なのか？　その理由を忘れることが多々あります。\nなので、本ぺージでは自分の理解のために、[Why Generics? - The Go Programing Language] の内容を抜粋・再整理しました。\nGenerics とは何か？ - Generic Programing の何が嬉しいのか？ まずはそもそも論として Generic Programming について整理しておきます\nGeneric Programming はプログラミングスタイルの１つで、特定の型に依存しないロジックやアルゴリズムを記述し、それと様々なデータ表現・型とを組み合わせる手法で、 Musser \u0026 Stepanov (1989) によって提唱されました。\nAda や Scheme が初期の、また有名な例として C++ の Standard Template Library (STL) が実装例として挙げられます。\n実例を見ていきましょう。\n例えば、スライスの順序を逆順に並び替える Reverse 関数を考えます。Generic Programming を使用しない、素朴な例であれば、以下に示すようにそれぞれの型ごとに実装を行う必要があります。\nfunc ReverseInts(s []Int) { f := 0 l := len(s) - 1 for f \u003c l { s[f], s[l] = s[l], s[f] f++ l-- } } func ReverseStrings(s []string) { f := 0 l := len(s) - 1 for f \u003c l { s[f], s[l] = s[l], s[f] f++ l-- } } これは手間です。型を定義するごとに同じようなロジックを書かなくてはいけません\nそこで型を抽象化し、型に依存しないコードを書くことにします。\nfunc Reverse[T any](s []T) { f := 0 l := len(s) - 1 for f \u003c l { s[f], s[l] := s[l], s[f] f++ l-- } } これで、 全ての型のスライスで 逆順に並び替える関数が使えるようになりました。 早速呼び出して (Go Playground) みましょう。 期待通りに動くはずです。\npackage main import \"fmt\" func Reverse[T any](s []T) { f := 0 l := len(s) - 1 for f \u003c l { s[f], s[l] = s[l], s[f] f++ l-- } } type User struct { Name string } func main() { ints := []int{0,1,2,3,4,5,6,7,8} fmt.Println(\"ordered: \", ints) Reverse(ints) fmt.Println(\"reversed: \", ints) strings := []string{\"apple\", \"grape\", \"orange\", \"banana\"} fmt.Println(\"ordered: \", strings) Reverse(strings) fmt.Println(\"reversed: \", strings) users := []User{{\"佐藤\"}, {\"鈴木\"}, {\"高橋\"}, {\"田中\"}, {\"伊藤\"}} fmt.Println(\"ordered: \", users) Reverse(users) fmt.Println(\"reversed: \", users) } これが Generics の嬉しいところです。\nその他の機能との使い分け Generics を使わなくても、Go 言語の他の機能を使用すれば目的の一部または全部を達成可能です。 とはいえ、デメリットもあるので、Generics が使えるようになった今、素直に Generics を使った方が良いでしょう。\ninterface を駆使する ingerface を駆使すればなんとかなります。実際に sort.Sort は sort できる interface である sort.Interface を用意し、実装しています。ちなみに sort.Reverse もあります。\n一見、これだけでよく見えますが、sort できる interface を満たすように、各型に関数を定義する必要があります。\n例えば、独自構造体で型を定義した type User struct{} のスライスで sort.Sort を使えるようにしたいのであれば、 []User は sort.Interface を満たさなければなりません。 つまり、Len(), Less(i, j int), Swap(i, j int) の実装がそれぞれで必要になり、あまり使いやすいとはいえないでしょう。\nreflect パッケージを使用する reflect パッケージを使用すれば、 go のコードを非常に動的に扱え、任意の型のスライスで動く Reverse 関数を用意することもできるでしょう。\nただし、まずこの関数を正しく記述するのはかなり大変です。また、実行は遅くなり、静的な型チェックはできなくなります。\nコードジェネレータにより、自動的にコードを生成する Go 言語のコード生成を使ってもゴールは達成できます。\n例えば、型の一覧を target.lst とかに列挙し、そこから各 Reverse 関数を自動生成するプログラム reverse_generator を用意した上で 定義ファイル reverse.go に以下のように宣言し、コード生成をしてみるのも良いでしょう。\n//go:generate reverse_generator target.lst これにより、go build すれば自動的にそれぞれの型向けのコードが生成されます。\nしかし、この手法は、参照するパッケージが増えるごとの毎回ビルドのし直しが走りますし、多分とても扱いにくいです。\nGenerics の基本的な文法 文法もアップデートされるので、こればかりは公式ドキュメントを参照した方が良いでしょう。\nそんなわけで Tutorial: Getting started with generics へのリンクを貼り、本文書を閉じたいと思います。\n","wordCount":"1491","inLanguage":"en","datePublished":"2024-07-24T00:00:00Z","dateModified":"2024-07-24T00:00:00Z","author":{"@type":"Person","name":"ayasuda"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ayasuda.github.io/pages/introduction_go_generics/"},"publisher":{"@type":"Organization","name":"ayasuda.github.io","logo":{"@type":"ImageObject","url":"https://ayasuda.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ayasuda.github.io/ accesskey=h title="ayasuda.github.io (Alt + H)">ayasuda.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://ayasuda.github.io/pages/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ayasuda.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ayasuda.github.io/pages/>Pages</a></div><h1 class=post-title>ぼくのための Generics (Go 言語) 入門</h1><div class=post-description>Genercis がなぜ欲しいのか？　とその基本的な構文について</div><div class=post-meta>&lt;span title='2024-07-24 00:00:00 +0000 UTC'>2024-07-24&lt;/span>&amp;nbsp;·&amp;nbsp;3 min&amp;nbsp;·&amp;nbsp;1491 words&amp;nbsp;·&amp;nbsp;ayasuda</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#interface-を駆使する>interface を駆使する</a></li><li><a href=#reflect-パッケージを使用する>reflect パッケージを使用する</a></li><li><a href=#コードジェネレータにより自動的にコードを生成する>コードジェネレータにより、自動的にコードを生成する</a></li></ul></nav></div></details></div><div class=post-content><p>なぜプログラミング言語に Generics 機能が必要なのか？　その理由を忘れることが多々あります。</p><p>なので、本ぺージでは自分の理解のために、[Why Generics? - The Go Programing Language] の内容を抜粋・再整理しました。</p><h1 id=generics-とは何か---generic-programing-の何が嬉しいのか>Generics とは何か？ - Generic Programing の何が嬉しいのか？<a hidden class=anchor aria-hidden=true href=#generics-とは何か---generic-programing-の何が嬉しいのか>#</a></h1><p>まずはそもそも論として <a href=https://www.dagstuhl.de/en/seminars/seminar-calendar/seminar-details/98171>Generic Programming</a> について整理しておきます</p><p>Generic Programming はプログラミングスタイルの１つで、特定の型に依存しないロジックやアルゴリズムを記述し、それと様々なデータ表現・型とを組み合わせる手法で、
<a href=https://doi.org/10.1007%2F3-540-51084-2_2>Musser & Stepanov (1989)</a> によって提唱されました。</p><p>Ada や Scheme が初期の、また有名な例として C++ の Standard Template Library (STL) が実装例として挙げられます。</p><p>実例を見ていきましょう。</p><p>例えば、スライスの順序を逆順に並び替える <code>Reverse</code> 関数を考えます。Generic Programming を使用しない、素朴な例であれば、以下に示すようにそれぞれの型ごとに実装を行う必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReverseInts</span>(<span style=color:#a6e22e>s</span> []<span style=color:#a6e22e>Int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>s</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#a6e22e>l</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>] = <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>]
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>f</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>l</span><span style=color:#f92672>--</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReverseStrings</span>(<span style=color:#a6e22e>s</span> []<span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>s</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#a6e22e>l</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>] = <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>]
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>f</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>l</span><span style=color:#f92672>--</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>これは手間です。型を定義するごとに同じようなロジックを書かなくてはいけません</p><p>そこで型を抽象化し、型に依存しないコードを書くことにします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Reverse</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>any</span>](<span style=color:#a6e22e>s</span> []<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>s</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#a6e22e>l</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>] <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>]
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>f</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>l</span><span style=color:#f92672>--</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>これで、 <em>全ての型のスライスで</em> 逆順に並び替える関数が使えるようになりました。
早速呼び出して (<a href=https://go.dev/play/p/BVQfLf2b3nL>Go Playground</a>) みましょう。
期待通りに動くはずです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:main.go data-lang=go:main.go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Reverse</span>[<span style=color:#a6e22e>T</span> <span style=color:#a6e22e>any</span>](<span style=color:#a6e22e>s</span> []<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>s</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#a6e22e>l</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>] = <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>l</span>], <span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>f</span>]
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>f</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>l</span><span style=color:#f92672>--</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ints</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>6</span>,<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>8</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ordered: &#34;</span>, <span style=color:#a6e22e>ints</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Reverse</span>(<span style=color:#a6e22e>ints</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;reversed: &#34;</span>, <span style=color:#a6e22e>ints</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>strings</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;apple&#34;</span>, <span style=color:#e6db74>&#34;grape&#34;</span>, <span style=color:#e6db74>&#34;orange&#34;</span>, <span style=color:#e6db74>&#34;banana&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ordered: &#34;</span>, <span style=color:#a6e22e>strings</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Reverse</span>(<span style=color:#a6e22e>strings</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;reversed: &#34;</span>, <span style=color:#a6e22e>strings</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>users</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>User</span>{{<span style=color:#e6db74>&#34;佐藤&#34;</span>},  {<span style=color:#e6db74>&#34;鈴木&#34;</span>}, {<span style=color:#e6db74>&#34;高橋&#34;</span>},  {<span style=color:#e6db74>&#34;田中&#34;</span>}, {<span style=color:#e6db74>&#34;伊藤&#34;</span>}}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ordered: &#34;</span>, <span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Reverse</span>(<span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;reversed: &#34;</span>, <span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>これが Generics の嬉しいところです。</p><h1 id=その他の機能との使い分け>その他の機能との使い分け<a hidden class=anchor aria-hidden=true href=#その他の機能との使い分け>#</a></h1><p>Generics を使わなくても、Go 言語の他の機能を使用すれば目的の一部または全部を達成可能です。
とはいえ、デメリットもあるので、Generics が使えるようになった今、素直に Generics を使った方が良いでしょう。</p><h2 id=interface-を駆使する>interface を駆使する<a hidden class=anchor aria-hidden=true href=#interface-を駆使する>#</a></h2><p>ingerface を駆使すればなんとかなります。実際に <a href=https://pkg.go.dev/sort#Sort>sort.Sort</a> は sort できる interface である
<a href=https://pkg.go.dev/sort#Interface>sort.Interface</a> を用意し、実装しています。ちなみに <a href=https://pkg.go.dev/sort#Reverse>sort.Reverse</a> もあります。</p><p>一見、これだけでよく見えますが、sort できる interface を満たすように、各型に関数を定義する必要があります。</p><p>例えば、独自構造体で型を定義した <code>type User struct{}</code> のスライスで <code>sort.Sort</code> を使えるようにしたいのであれば、 <code>[]User</code> は <code>sort.Interface</code> を満たさなければなりません。
つまり、<code>Len()</code>, <code>Less(i, j int)</code>, <code>Swap(i, j int)</code> の実装がそれぞれで必要になり、あまり使いやすいとはいえないでしょう。</p><h2 id=reflect-パッケージを使用する>reflect パッケージを使用する<a hidden class=anchor aria-hidden=true href=#reflect-パッケージを使用する>#</a></h2><p>reflect パッケージを使用すれば、 go のコードを非常に動的に扱え、任意の型のスライスで動く <code>Reverse</code> 関数を用意することもできるでしょう。</p><p>ただし、まずこの関数を正しく記述するのはかなり大変です。また、実行は遅くなり、静的な型チェックはできなくなります。</p><h2 id=コードジェネレータにより自動的にコードを生成する>コードジェネレータにより、自動的にコードを生成する<a hidden class=anchor aria-hidden=true href=#コードジェネレータにより自動的にコードを生成する>#</a></h2><p>Go 言語のコード生成を使ってもゴールは達成できます。</p><p>例えば、型の一覧を <code>target.lst</code> とかに列挙し、そこから各 <code>Reverse</code> 関数を自動生成するプログラム <code>reverse_generator</code> を用意した上で
定義ファイル <code>reverse.go</code> に以下のように宣言し、コード生成をしてみるのも良いでしょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:reverse.go data-lang=go:reverse.go><span style=display:flex><span><span style=color:#75715e>//go:generate reverse_generator target.lst
</span></span></span></code></pre></div><p>これにより、<code>go build</code> すれば自動的にそれぞれの型向けのコードが生成されます。</p><p>しかし、この手法は、参照するパッケージが増えるごとの毎回ビルドのし直しが走りますし、多分とても扱いにくいです。</p><h1 id=generics-の基本的な文法>Generics の基本的な文法<a hidden class=anchor aria-hidden=true href=#generics-の基本的な文法>#</a></h1><p>文法もアップデートされるので、こればかりは公式ドキュメントを参照した方が良いでしょう。</p><p>そんなわけで <a href=https://go.dev/doc/tutorial/generics>Tutorial: Getting started with generics</a> へのリンクを貼り、本文書を閉じたいと思います。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ayasuda.github.io/tags/go/>Go</a></li><li><a href=https://ayasuda.github.io/tags/generics/>Generics</a></li></ul><nav class=paginav><a class=next href=https://ayasuda.github.io/pages/snippet_golang_flag/><span class=title>Next »</span><br><span>Go 言語でのコマンドライン引数処理</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ayasuda.github.io/>ayasuda.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>